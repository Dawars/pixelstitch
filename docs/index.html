---

title: pyxelstitch


keywords: fastai
sidebar: home_sidebar

summary: "Simple, matplotlib based tool for hand-labeling the two-image correspondences"
description: "Simple, matplotlib based tool for hand-labeling the two-image correspondences"
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install pixelstitch</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's test our annotator on a sample project. It needs a list of triplets: (<code>path_to_img1</code>, <code>path_to_img2</code>, <code>path_to_corrs_to_save</code>).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">rootdir</span> <span class="o">=</span> <span class="s1">&#39;sample_project&#39;</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">rootdir</span><span class="p">)</span>
<span class="n">img_pairs_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;.DS_Store&#39;</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">cur_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">img_pairs_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cur_dir</span><span class="p">,</span> <span class="s1">&#39;01.png&#39;</span><span class="p">),</span>
                           <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cur_dir</span><span class="p">,</span> <span class="s1">&#39;02.png&#39;</span><span class="p">),</span>
                           <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cur_dir</span><span class="p">,</span> <span class="s1">&#39;corrs.txt&#39;</span><span class="p">)))</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">img_pairs_list</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[(&#39;sample_project/ministry/01.png&#39;, &#39;sample_project/ministry/02.png&#39;, &#39;sample_project/ministry/corrs.txt&#39;), (&#39;sample_project/petrzin/01.png&#39;, &#39;sample_project/petrzin/02.png&#39;, &#39;sample_project/petrzin/corrs.txt&#39;)]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/envs/python39/lib/python3.9/site-packages/ipykernel/ipkernel.py:283: DeprecationWarning: `should_run_async` will not call `transform_cell` automatically in the future. Please pass the result to `transformed_cell` argument and any exception that happen during thetransform in `preprocessing_exc_tuple` in IPython 7.17 and above.
  and should_run_async(code)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we are ready to initialize <a href="/pixelstitch/core.html#CorrespondenceAnnotator"><code>CorrespondenceAnnotator</code></a>. Don't forget to declare magic command <code>%matplotlib notebook</code>.
<strong>WITHOUT MAGIC IT WOULD NOT WORK</strong></p>
<p>You also should explicitly specify, if you want to save (and possibly over-write previous better annotation) current correspondences automatically when clicking on <strong>prev</strong> and <strong>next</strong> buttons for going to the next pair.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> notebook
<span class="kn">from</span> <span class="nn">pixelstitch.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">CA</span> <span class="o">=</span> <span class="n">CorrespondenceAnnotator</span><span class="p">(</span><span class="n">img_pairs_list</span><span class="p">,</span> <span class="n">save_on_next</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/envs/python39/lib/python3.9/site-packages/ipykernel/ipkernel.py:283: DeprecationWarning: `should_run_async` will not call `transform_cell` automatically in the future. Please pass the result to `transformed_cell` argument and any exception that happen during thetransform in `preprocessing_exc_tuple` in IPython 7.17 and above.
  and should_run_async(code)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can run the annotation.</p>
<p><strong>Left-click</strong> on the image to add a point</p>
<p><strong>right-click</strong> -- to remove the point from both images.</p>
<h3 id="Matplotlib-shortcuts:">Matplotlib shortcuts:<a class="anchor-link" href="#Matplotlib-shortcuts:"> </a></h3><ul>
<li><strong>o</strong> for zoom </li>
<li><strong>p</strong> for pan (move)</li>
</ul>
<p>It is also recommended to set full page width for the jupyter</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;style&gt;.container { width:95% !important; }&lt;/style&gt;&quot;</span><span class="p">))</span>
<span class="n">CA</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/pixelstitch/index_files/att_00008.png" alt="image.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Controls">Controls<a class="anchor-link" href="#Controls"> </a></h1><h2 id="Selectors">Selectors<a class="anchor-link" href="#Selectors"> </a></h2><ul>
<li><code>Model</code>. One can select between "<code>F</code>" -- fundamental matrix and "<code>H</code>" -- homography. The selection influences the reprojection error type, and the visualization of the models and reprojection errors, shown when clicked on <code>NextCorrsValPoint</code>,  <code>NextCorrsValAll</code> and  <code>ShowModel</code> buttons.</li>
</ul>
<h2 id="Buttons">Buttons<a class="anchor-link" href="#Buttons"> </a></h2><ul>
<li><p><code>NextCorrsValPoint</code>. Shows the correspondence in the bottom axis. The image title shows correspondence index and the reprojection error. If <code>Model</code> is <code>F</code>, it will show induced epipolar line, if <code>H</code> -- the position of the reprojected point from other image. The model is estimated with all other correspondences except current one.</p>
</li>
<li><p><code>NextCorrsValAll</code>. Shows the correspondences in the bottom axis. Similar to <code>NextCorrsValPoint</code> button, but shows all points. The model is estimated with all  correspondences except current one, which index is shown in the title. 
<img src="/pixelstitch/index_files/att_00005.png" alt="image.png"></p>
</li>
</ul>
<ul>
<li><p><code>ShowModel</code>. Has different behavoir depending on the <code>Model</code> selected. For <code>F</code> -- shows correspondences with their induced epipolar lines. Unlike <code>NextCorrsValPoint</code> and <code>NextCorrsValPoint</code> all correspondences are used for model estimation. 
<img src="/pixelstitch/index_files/att_00003.png" alt="image.png"></p>
</li>
<li><p>For <code>H</code>, the button shows overlay of image 1 reprojected into image2 with image2. The reprojected area is defined by the convex hull of the labelled correspondences. Next click flips the order, i.e. shows the image 2 reprojected into image 1.
<img src="/pixelstitch/index_files/att_00002.png" alt="image.png"></p>
</li>
<li><p><code>Save points</code> -- saves (overwrites) the correspondences into the text file.</p>
</li>
<li><p><code>Prev</code> -- Loads and shows previous image pair to label. If the <a href="/pixelstitch/core.html#CorrespondenceAnnotator"><code>CorrespondenceAnnotator</code></a> was initialized with <code>save_on_next=True</code>, the current pair correspondences are saved before the switch. Change is not cyclical, so the button does nothing on 1st image pair</p>
</li>
<li><p><code>Next</code> -- Loads and shows next image pair to label. If the <a href="/pixelstitch/core.html#CorrespondenceAnnotator"><code>CorrespondenceAnnotator</code></a> was initialized with <code>save_on_next=True</code>, the current pair correspondences are saved before the switch.Change is not cyclical, so the button does nothing on last image pair.</p>
</li>
<li><p><code>CLAHE</code> -- Images are shown with enhanced contrast with <a href="http://amroamroamro.github.io/mexopencv/opencv/clahe_demo_gui.html">CLAHE</a> algorithm.
<img src="/pixelstitch/index_files/att_00004.png" alt="image.png"></p>
</li>
</ul>
<ul>
<li><p><code>Pick 4 points for homography</code> -- Special mode. User picks 4 points in one image, which define new fronto-parallel view. This mode helps for labeling obscure views, see example below. The order of the points: top-left -&gt; top-right -&gt; bottom right -&gt; bottom left. After the 4 point picked, the mode is switched off, so user needs to click the button again if she wants to rectify another image.</p>
</li>
<li><p><code>ResetView</code> -- Resets any recifications or zoom done to images.</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Rectification-picking-mode-example">Rectification picking mode example<a class="anchor-link" href="#Rectification-picking-mode-example"> </a></h3><p>3 points are selected
<img src="/pixelstitch/index_files/att_00006.png" alt="image.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All points are selected and image1 is rectified to the rectangle, defined by the selected points
<img src="/pixelstitch/index_files/att_00007.png" alt="image.png"></p>

</div>
</div>
</div>
</div>
 

