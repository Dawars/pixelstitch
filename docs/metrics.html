---

title: metrics


keywords: fastai
sidebar: home_sidebar

summary: "Functions for evluation if the labeling is good/done"
description: "Functions for evluation if the labeling is good/done"
nb_path: "metrics.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: metrics.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/envs/python39/lib/python3.9/site-packages/ipykernel/ipkernel.py:283: DeprecationWarning: `should_run_async` will not call `transform_cell` automatically in the future. Please pass the result to `transformed_cell` argument and any exception that happen during thetransform in `preprocessing_exc_tuple` in IPython 7.17 and above.
  and should_run_async(code)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/envs/python39/lib/python3.9/site-packages/ipykernel/ipkernel.py:283: DeprecationWarning: `should_run_async` will not call `transform_cell` automatically in the future. Please pass the result to `transformed_cell` argument and any exception that happen during thetransform in `preprocessing_exc_tuple` in IPython 7.17 and above.
  and should_run_async(code)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="leave_one_out_F_validation" class="doc_header"><code>leave_one_out_F_validation</code><a href="https://github.com/ducha-aiki/pixelstitch/tree/master/pixelstitch/metrics.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>leave_one_out_F_validation</code>(<strong><code>corrs</code></strong>:<code>ndarray</code>, <strong><code>error</code></strong>:<code>str</code>=<em><code>'symepi'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/envs/python39/lib/python3.9/site-packages/ipykernel/ipkernel.py:283: DeprecationWarning: `should_run_async` will not call `transform_cell` automatically in the future. Please pass the result to `transformed_cell` argument and any exception that happen during thetransform in `preprocessing_exc_tuple` in IPython 7.17 and above.
  and should_run_async(code)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="leave_one_out_H_validation" class="doc_header"><code>leave_one_out_H_validation</code><a href="https://github.com/ducha-aiki/pixelstitch/tree/master/pixelstitch/metrics.py#L43" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>leave_one_out_H_validation</code>(<strong><code>corrs</code></strong>:<code>ndarray</code>, <strong><code>error</code></strong>:<code>str</code>=<em><code>'symtransfer'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/envs/python39/lib/python3.9/site-packages/ipykernel/ipkernel.py:283: DeprecationWarning: `should_run_async` will not call `transform_cell` automatically in the future. Please pass the result to `transformed_cell` argument and any exception that happen during thetransform in `preprocessing_exc_tuple` in IPython 7.17 and above.
  and should_run_async(code)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_error_stat_string" class="doc_header"><code>get_error_stat_string</code><a href="https://github.com/ducha-aiki/pixelstitch/tree/master/pixelstitch/metrics.py#L74" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_error_stat_string</code>(<strong><code>errors</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/envs/python39/lib/python3.9/site-packages/ipykernel/ipkernel.py:283: DeprecationWarning: `should_run_async` will not call `transform_cell` automatically in the future. Please pass the result to `transformed_cell` argument and any exception that happen during thetransform in `preprocessing_exc_tuple` in IPython 7.17 and above.
  and should_run_async(code)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_big_errors_string" class="doc_header"><code>get_big_errors_string</code><a href="https://github.com/ducha-aiki/pixelstitch/tree/master/pixelstitch/metrics.py#L78" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_big_errors_string</code>(<strong><code>errors</code></strong>, <strong><code>th</code></strong>=<em><code>3.0</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/envs/python39/lib/python3.9/site-packages/ipykernel/ipkernel.py:283: DeprecationWarning: `should_run_async` will not call `transform_cell` automatically in the future. Please pass the result to `transformed_cell` argument and any exception that happen during thetransform in `preprocessing_exc_tuple` in IPython 7.17 and above.
  and should_run_async(code)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The function estimates the fundamental matrix or homography using (n-1) correspondences and returns error on that leaved-out correspondence (corr). The operation is repeated for every corr and the output is dict with those errors, together with min, mean, max and max_idx.
I have got the idea from the <a href="https://arxiv.org/abs/2106.10240">VSAC</a> paper</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">corrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;sample_project/petrzin/corrs.txt&#39;</span><span class="p">)</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">leave_one_out_F_validation</span><span class="p">(</span><span class="n">corrs</span><span class="p">,</span> <span class="s1">&#39;symepi&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Symmetrical epipolar distance, min error = </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, max_error=</span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, at </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;max_idx&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, mean_error=</span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">leave_one_out_F_validation</span><span class="p">(</span><span class="n">corrs</span><span class="p">,</span> <span class="s1">&#39;sampson&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sampson error, min error = </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, max_error=</span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, at </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;max_idx&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, mean_error=</span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">get_error_stat_string</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">get_big_errors_string</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dict_keys([&#39;min&#39;, &#39;max&#39;, &#39;mean&#39;, &#39;all&#39;, &#39;max_idx&#39;])
Symmetrical epipolar distance, min error = 0.0941, max_error=16.8127, at 38, mean_error=2.0064
Sampson error, min error = 0.0463, max_error=7.8037, at 38, mean_error=0.9528
Errors: min = 0.05, max=7.80, at 38, mean=0.95
Error &gt; 3.0 px, idxs: [38]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/envs/python39/lib/python3.9/site-packages/ipykernel/ipkernel.py:283: DeprecationWarning: `should_run_async` will not call `transform_cell` automatically in the future. Please pass the result to `transformed_cell` argument and any exception that happen during thetransform in `preprocessing_exc_tuple` in IPython 7.17 and above.
  and should_run_async(code)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">corrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;sample_project/petrzin/corrs.txt&#39;</span><span class="p">)</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">leave_one_out_H_validation</span><span class="p">(</span><span class="n">corrs</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Symmetrical transfer distance, min error = </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, max_error=</span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, at </span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;max_idx&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, mean_error=</span><span class="si">{</span><span class="n">errors</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">get_error_stat_string</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dict_keys([&#39;min&#39;, &#39;max&#39;, &#39;mean&#39;, &#39;all&#39;, &#39;max_idx&#39;])
Symmetrical transfer distance, min error = 0.8725, max_error=152.3928, at 16, mean_error=50.3009
Errors: min = 0.87, max=152.39, at 16, mean=50.30
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/envs/python39/lib/python3.9/site-packages/ipykernel/ipkernel.py:283: DeprecationWarning: `should_run_async` will not call `transform_cell` automatically in the future. Please pass the result to `transformed_cell` argument and any exception that happen during thetransform in `preprocessing_exc_tuple` in IPython 7.17 and above.
  and should_run_async(code)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

